"use strict";var WPFormsFormAbandonment=window.WPFormsFormAbandonment||function(o,a,t){var r,i={},m=!1,s=!1,e=!1,d={mobileDetect:null,init:function(){var n;"undefined"!=typeof MobileDetect&&(d.mobileDetect=new MobileDetect(a.navigator.userAgent)),t(o).on("input",".wpforms-form-abandonment :input",d.prepData),t(o).on("change",".wpforms-form-abandonment input[type=radio]",d.prepData),t(o).on("change",".wpforms-form-abandonment input[type=checkbox]",d.prepData),t(o).on("change",".wpforms-form-abandonment .wpforms-timepicker",d.prepData),t(o).on("mouseleave",this.abandonMouse),t(o).on("mouseenter",this.abandonMouseCancel),d.isMobileDevice()?(d.isIOSDevice()&&t("a").css("cursor","pointer"),n="ontouchstart"in a?"touchstart":"click",t(o).on(n,this.abandonClick)):t(o).on("mousedown",this.abandonClick),t(a).on("beforeunload",this.abandonBeforeUnload),t(".wpforms-form").on("wpformsBeforeFormSubmit",d.unbindAbandonBeforeUnloadOnNormalSubmit),t(".wpforms-form").on("wpformsAjaxSubmitSuccess",d.ajaxSubmitSuccess)},isMobileDevice:function(){return!!d.mobileDetect&&!!d.mobileDetect.mobile()},isIOSDevice:function(){return!!d.mobileDetect&&"iOS"===d.mobileDetect.os()},prepData:function(n){n=t(n.target).closest(".wpforms-form");r=n.data("formid"),i[r]=n.serializeArray(),m=JSON.stringify(i),d.debug("Preping data")},sendData:function(){var n,e;m&&!s&&r&&void 0!==i[r]&&(s=!0,setTimeout(function(){s=!1},1e4),d.debug("Sending"),(n=new FormData).append("action","wpforms_form_abandonment"),n.append("forms",m),n.append("page_url",wpforms_form_abandonment.page_url),"function"==typeof a.navigator.sendBeacon&&!0===a.navigator.sendBeacon(wpforms_form_abandonment.ajaxurl,n)?t(o).trigger("wpformsFormAbandonmentDataSent",n):((e=new XMLHttpRequest).open("POST",wpforms_form_abandonment.ajaxurl,!0),e.send(n),200===e.status&&t(o).trigger("wpformsFormAbandonmentDataSent",n)),m=!(i={}))},abandonMouse:function(n){n.offsetX<-1||20<n.clientY||(e=setTimeout(function(){d.debug("Mouse abandoned"),d.sendData()},wpforms_form_abandonment.mouse_leave_timeout))},abandonMouseCancel:function(){e&&clearTimeout(e)},abandonClick:function(n){for(var e,o,a=n.srcElement||n.target;a&&(void 0===a.tagName||"a"!==a.tagName.toLowerCase()||!a.href);)a=a.parentNode;a&&a.href&&(d.debug("Click abandoned"),e=a.href,o="internal","mailto"===a.protocol?o="mailto":-1===e.indexOf(wpforms_form_abandonment.home_url)&&(o="external"),["external","internal"].indexOf(o)<0||e.match(/^javascript\:/i)||(o=!(!a.target||a.target.match(/^_(self|parent|top)$/i))&&a.target,((o=n.ctrlKey||n.shiftKey||n.metaKey||2===n.which?"_blank":o)||d.isIOSDevice())&&d.sendData()))},abandonBeforeUnload:function(n){d.debug("Before unload abandoned"),d.sendData()},unbindAbandonBeforeUnloadOnNormalSubmit:function(n){const e=t(n.target);e.length<=0||e.first().hasClass("wpforms-ajax-form")||(d.debug("Unbinding abandonBeforeUnload"),t(a).off("beforeunload",this.abandonBeforeUnload))},ajaxSubmitSuccess:function(){d.debug("Ajax submit success event");var n=t(this).data("formid");delete i[n],r=void 0,m=JSON.stringify(i)},debug:function(n){a.location.hash&&"#wpformsfadebug"===a.location.hash&&console.log("WPForms FA: "+n)}};return d}(document,window,jQuery);WPFormsFormAbandonment.init();